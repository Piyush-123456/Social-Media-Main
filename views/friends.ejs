<%- include("partials/header") %>
  <%- include("partials/nav") %>

    <div class="container">

      <h2 class="section-title">Make Your Friends...</h2>
      <hr>

      <div class="user-list">
        <% users.forEach(singleuser=> { %>
          <div class="user-card">
            <img class="user-avatar"
              src="<%= singleuser.avatar.url ? singleuser.avatar.url : 'https://th.bing.com/th/id/OIP.ixZ69lPCOZ3ZO5UqSHQGIAHaHa?w=198&h=198&c=7&r=0&o=5&dpr=1.3&pid=1.7' %>"
              alt="<%= singleuser.fullname %>'s avatar">
            <h5 class="friend-name">
              <%= singleuser.fullname %>
            </h5>
            <% if (singleuser._id !=user._id) { %>
              <form action="/user/friend-request/<%= singleuser._id %>" method="POST">
                <input type="hidden" name="requesterId" value="<%= user._id %>">
                <button class="btn btn-primary" type="submit">Add Friend</button>
              </form>
              <% } %>
          </div>
          <% }); %>
      </div>

      <hr>
      <h2 class="section-title" style="margin-top: 20px;">Friend Requests</h2>

      <ul class="friend-request-list">
        <% if (user.friendRequests.length===0) { %>
          <h1 style="font-family: gilroy; font-size: 16px;">You don't have any requests yet...</h1>
          <hr>
          <% } else { %>
            <% user.friendRequests.forEach(request=> { %>
              <li class="friend-request-item">
                <img class="request-avatar"
                  src="<%= request.avatar.url ? request.avatar.url : 'https://th.bing.com/th/id/OIP.ixZ69lPCOZ3ZO5UqSHQGIAHaHa?w=198&h=198&c=7&r=0&o=5&dpr=1.3&pid=1.7' %>"
                  alt="<%= request.fullname %>'s avatar">
                <span class="request-info">
                  <%= request.fullname %>
                </span>
                <form action="/user/friend-request/<%= request._id %>/accept" method="POST">
                  <button type="submit" class="accept-btn">Accept</button>
                </form>
                <form action="/user/friend-request/<%= request._id %>/decline" method="POST">
                  <button type="submit" class="decline-btn">Decline</button>
                </form>
              </li>
              <hr>
              <% }); %>
                <% } %>
      </ul>

      <h2 class="section-title" style="margin-top: 20px;">Your Friends</h2>
      <hr>
      <div class="user-list">
        <%user.friends.forEach((friend)=>{%>
          <div class="user-card ">
            <img class="user-avatar"
              src="<%= friend.avatar.url ? friend.avatar.url : 'https://th.bing.com/th/id/OIP.ixZ69lPCOZ3ZO5UqSHQGIAHaHa?w=198&h=198&c=7&r=0&o=5&dpr=1.3&pid=1.7' %>"
              class="card-img-top" alt="<%= friend.fullname %>">
            <div class="card-body">
              <h5 class="card-title">
                <%=friend.fullname%>
              </h5>
              <p class="card-text">
                <%=friend.username%>
              </p>
              <div class="d-flex gap-2">

                <a href="/user/userprofile/<%=friend._id%>" class="btn btn-primary">Visit Profile</a>
                <form action="/user/unfriend/<%=friend._id%>" method="post">
                  <button class="btn btn-danger">
                    Unfriend
                  </button>

                </form>
              </div>
            </div>
          </div>
          <%})%>
      </div>
    </div>

    <style>
      body {
        font-family: 'Gilroy', sans-serif;
        margin: 0;
        padding: 0;
      }

      .container {
        padding: 25px 0px;
      }

      .section-title {
        font-family: gilroy;
        font-size: 22px;
        font-weight: bolder;
        margin-bottom: 10px;
      }

      .section-divider {
        margin-top: 10px;
        margin-bottom: 20px;
        border: 0;
        border-top: 1px solid #ccc;
      }

      .user-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        /* Adjust column width as needed */
        gap: 40px;
        margin: auto;
        font-family: 'Gilroy', sans-serif;
        padding: 30px 20px;
        background-color: rgba(232, 226, 226, 0.316);
        /* Example background color */
      }

      .user-card {
        height: 100%;
        /* Adjust height to fit content */
        border: 1px solid rgb(196, 191, 191);
        border-radius: 30px;
        padding: 20px 10px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        /* Center text content */
      }

      .user-avatar {
        height: 130px;
        width: 130px;
        border-radius: 50%;
        flex-shrink: 0;
      }

      .friend-name {
        font-weight: 200;
        font-size: 17px;
        margin-top: 10px;
      }

      .friend-request-list {
        list-style-type: none;
        padding: 0;
      }

      .friend-request-item {
        margin-bottom: 10px;
        width: fit-content;
        padding: 10px 30px;
        border: 1px solid #e9e5e5;
        border-radius: 5px;
        display: flex;
        align-items: center;
      }

      .request-avatar {
        height: 70px;
        width: 70px;
        border-radius: 50%;
        flex-shrink: 0;
        object-fit: cover;
        margin-right: 10px;
      }

      .request-info {
        font-size: 18px;
        flex-grow: 1;
      }

      .accept-btn,
      .decline-btn {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
        margin-left: 10px;
      }

      .decline-btn {
        background-color: #dc3545;
        margin-left: 5px;
      }
    </style>
    <%- include("partials/footer") %>